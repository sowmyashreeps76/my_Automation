import { expect } from '@playwright/test';
import { click, fill } from '../../../src/wcb-automation/utils/action-utils';
import { expectElementToBeVisible } from '../../../src/wcb-automation/utils/assert-utils';
import {
  getLocator,
  getLocatorByRole,
} from '../../../src/wcb-automation/utils/locator-utils';

// ---------- Locators (using same pattern as login page) ----------

// Global toolbar / policy search (step 18)
const globalPolicyButton = () => getLocator('#FEKQc-btn');                   // <- use your stored locator here
const policyMenu         = () => getLocatorByRole('menuitem', { name: 'Policy' });
const globalSearchBox    = () => getLocatorByRole('textbox', { name: 'Global Search' });
const policyCheckbox     = () => getLocatorByRole('checkbox', { name: 'checkbox' });
const finishButton       = () => getLocatorByRole('button', { name: 'Finish' });

// Add Document – REG030 (step 19)
const addDocumentMenu    = () => getLocatorByRole('menuitem', { name: 'Add Document' });
const documentTextbox    = () => getLocatorByRole('textbox', { name: 'Document' });
const reg030Row          = () => getLocator('text=REG030');                   // or any locator you stored
const documentInfoWindow = () => getLocator('text=Document Information');     // header/title text

// Tabs & grids (step 20)
const recipientsTab      = () => getLocator('text=Recipients');
const recipientsGrid     = () => getLocatorByRole('grid', { name: /Recipient/i });

const dataElementsTab    = () => getLocator('text=Data Elements');
const dataElementsGrid   = () => getLocatorByRole('grid', { name: /Data Element/i });

const turnaroundTab      = () => getLocator('text=Turnaround');
const expectedReturnDays = () =>
  getLocatorByRole('textbox', { name: 'Expected Return Days' });

// Toolbar on Document Information window (step 21)
const saveButton         = () => getLocatorByRole('button', { name: 'Save' });
const closeButton        = () => getLocatorByRole('button', { name: 'Close' });

// ---------- Step functions ----------

// Step 18 – open the policy from Global Search
export async function openPolicyFromGlobalSearch(policyNumber: string) {
  await click(globalPolicyButton);
  await click(policyMenu);

  await click(globalSearchBox);
  await fill(globalSearchBox, policyNumber);

  await click(policyCheckbox);
  await click(finishButton);
}

// Step 19 – Add Document REG030 and open Document Information
export async function addReg030Document() {
  await click(addDocumentMenu);

  await click(documentTextbox);
  await fill(documentTextbox, 'REG030');

  await click(reg030Row);
  await click(finishButton);

  await expectElementToBeVisible(documentInfoWindow);
}

// Step 20 – Confirm Recipients & Data Elements, then Turnaround → Expected Return Days
export async function verifyRecipientsAndDataElements() {
  await click(recipientsTab);
  await expectElementToBeVisible(recipientsGrid);

  await click(dataElementsTab);
  await expectElementToBeVisible(dataElementsGrid);
}

export async function verifyExpectedReturnDaysIs(expectedDays: string) {
  await click(turnaroundTab);
  await expectElementToBeVisible(expectedReturnDays);

  // check the value is 300
  await expect(expectedReturnDays()).toHaveValue(expectedDays);
}

// Step 21 – Save and Close
export async function saveAndCloseDocumentInformation() {
  await click(saveButton);
  await click(closeButton);
}




import { test } from '@playwright/test';
import {
  navigateToWCBLoginPage,
  loginSuccessfully,
} from '../pages/preferred-pom/wcb-login-page';
import {
  openPolicyFromGlobalSearch,
  addReg030Document,
  verifyRecipientsAndDataElements,
  verifyExpectedReturnDaysIs,
  saveAndCloseDocumentInformation,
} from '../pages/preferred-pom/wcb-document-info-page';

test('REG030 – verify Expected Return Days is 300 and save', async () => {
  // Login (your existing page helpers)
  await navigateToWCBLoginPage();
  await loginSuccessfully();

  // Step 18 – open the policy
  await openPolicyFromGlobalSearch('E0000877'); // use the same policy number from your steps

  // Step 19 – Add Document REG030
  await addReg030Document();

  // Step 20 – verify Recipients & Data Elements and Expected Return Days
  await verifyRecipientsAndDataElements();
  await verifyExpectedReturnDaysIs('300');

  // Step 21 – Save and Close
  await saveAndCloseDocumentInformation();
});

